{% extends "base.html" %} {% block content %}
<div class="container mt-4">
  <h1>Approval Workflows</h1>
  <a href="{{ url_for('add_workflow') }}" class="btn btn-primary mb-3">
    <i class="fas fa-plus"></i> Add Workflow
  </a>
  <div class="card">
    <div class="card-header bg-primary text-white">Configured Workflows</div>
    <div class="card-body">
      {% if workflows %}
      <table class="table">
        <thead>
          <tr>
            <th>Name</th>
            <th>Form Type</th>
            <th>Org Unit</th>
            <th>Active</th>
            <th>Steps</th>
          </tr>
        </thead>
        <tbody>
          {% for wf in workflows %}
          <tr>
            <td>{{ wf.name }}</td>
            <td>{{ wf.form_type or 'All' }}</td>
            <td>{{ wf.org_unit.name if wf.org_unit else 'All Units' }}</td>
            <td>{{ 'Yes' if wf.active else 'No' }}</td>
            <td>
              <ul>
                {% for step in wf.steps|sort(attribute='order') %}
                <li>
                  {{ step.order }}. {{ step.name }} ({{ step.approver_role.name
                  if step.approver_role else 'Any' }}) {% if step.org_unit %}
                  [{{ step.org_unit.name }}]{% endif %}
                </li>
                {% endfor %}
              </ul>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      {% else %}
      <p>No workflows configured.</p>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}
